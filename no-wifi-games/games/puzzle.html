<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊãºÂõæÊ∏∏Êàè - No WiFi Games</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; user-select: none; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            padding: 20px;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1rem;
        }
        h1 { margin-top: 50px; font-size: 2.2rem; margin-bottom: 10px; }
        .subtitle { color: #888; margin-bottom: 20px; }
        .stats {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }
        .stats div { font-size: 1.1rem; }
        .stats span { color: #e94560; font-weight: bold; }
        #gameContainer {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        #puzzleBoard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            background: #333;
            padding: 5px;
            border-radius: 5px;
            width: 320px;
            height: 320px;
        }
        .puzzle-piece {
            width: 100%;
            height: 100%;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .puzzle-piece:hover { filter: brightness(1.1); }
        .puzzle-piece.selected { box-shadow: 0 0 0 3px #e94560; z-index: 1; }
        .preview {
            text-align: center;
        }
        .preview h3 { margin-bottom: 10px; color: #888; }
        #previewImage {
            width: 160px;
            height: 160px;
            border-radius: 10px;
            object-fit: cover;
        }
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 12px 25px;
            background: #e94560;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }
        .win-message {
            font-size: 1.5rem;
            color: #4caf50;
            margin-top: 20px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .win-message.show { opacity: 1; }
        .image-select {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .img-option {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        .img-option:hover { transform: scale(1.1); }
        .img-option.selected { border-color: #e94560; }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">‚Üê ËøîÂõû</a>
    <h1>üñºÔ∏è ÊãºÂõæÊ∏∏Êàè</h1>
    <p class="subtitle">ÈÄâÊã©ÂõæÁâáÔºåÂÆåÊàêÊãºÂõæ</p>
    
    <div class="image-select" id="imageSelect">
        <!-- Image options generated by JS -->
    </div>
    
    <div class="stats">
        <div>Ê≠•Êï∞: <span id="moves">0</span></div>
        <div>Êó∂Èó¥: <span id="time">00:00</span></div>
    </div>
    
    <div id="gameContainer">
        <div id="puzzleBoard"></div>
        <div class="preview">
            <h3>ÁõÆÊ†áÂõæÊ°à</h3>
            <canvas id="previewImage"></canvas>
        </div>
    </div>
    
    <div class="win-message" id="winMsg">üéâ ÊãºÂõæÂÆåÊàêÔºÅ</div>
    
    <div class="controls">
        <button onclick="initGame()">Êñ∞Ê∏∏Êàè</button>
        <button onclick="showHint()">ÊèêÁ§∫</button>
        <select id="difficulty" onchange="initGame()" style="padding: 10px; border-radius: 8px; background: #333; color: white; border: none;">
            <option value="3">ÁÆÄÂçï (3x3)</option>
            <option value="4" selected>‰∏≠Á≠â (4x4)</option>
            <option value="5">Âõ∞Èöæ (5x5)</option>
        </select>
    </div>

    <script>
    // Á¶ÅÊ≠¢ÈïøÊåâÂ§çÂà∂ËèúÂçï
    document.addEventListener('contextmenu', e => e.preventDefault());
        const PATTERNS = [
            { name: 'gradient', colors: ['#e94560', '#4caf50', '#2196f3', '#ffeb3b'] },
            { name: 'rainbow', colors: ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3'] },
            { name: 'ocean', colors: ['#001f3f', '#0074d9', '#7fdbff', '#39cccc'] },
            { name: 'sunset', colors: ['#ff4136', '#ff851b', '#ffdc00', '#f012be'] }
        ];
        
        let currentPattern, gridSize, pieces, correctOrder, selectedPiece, moves, seconds, timer, isPlaying;
        
        function initImageSelect() {
            const container = document.getElementById('imageSelect');
            PATTERNS.forEach((p, i) => {
                const canvas = document.createElement('canvas');
                canvas.className = 'img-option' + (i === 0 ? ' selected' : '');
                canvas.width = 60;
                canvas.height = 60;
                const ctx = canvas.getContext('2d');
                const grad = ctx.createLinearGradient(0, 0, 60, 60);
                p.colors.forEach((c, j) => grad.addColorStop(j / (p.colors.length - 1), c));
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, 60, 60);
                canvas.onclick = () => selectPattern(i);
                container.appendChild(canvas);
            });
        }
        
        function selectPattern(index) {
            document.querySelectorAll('.img-option').forEach((el, i) => {
                el.classList.toggle('selected', i === index);
            });
            currentPattern = PATTERNS[index];
            initGame();
        }
        
        function initGame() {
            gridSize = parseInt(document.getElementById('difficulty').value);
            if (!currentPattern) currentPattern = PATTERNS[0];
            
            document.getElementById('puzzleBoard').style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            document.getElementById('puzzleBoard').style.width = `${gridSize * 80}px`;
            document.getElementById('puzzleBoard').style.height = `${gridSize * 80}px`;
            
            // Create puzzle pieces
            pieces = [];
            correctOrder = [];
            const pieceSize = 320 / gridSize;
            
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const canvas = document.createElement('canvas');
                    canvas.width = pieceSize;
                    canvas.height = pieceSize;
                    const ctx = canvas.getContext('2d');
                    
                    // Draw gradient piece
                    const grad = ctx.createLinearGradient(0, 0, pieceSize, pieceSize);
                    const colorIndex = (r + c) % currentPattern.colors.length;
                    grad.addColorStop(0, currentPattern.colors[colorIndex]);
                    grad.addColorStop(1, currentPattern.colors[(colorIndex + 1) % currentPattern.colors.length]);
                    ctx.fillStyle = grad;
                    ctx.fillRect(0, 0, pieceSize, pieceSize);
                    
                    // Add border
                    ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                    ctx.strokeRect(0, 0, pieceSize, pieceSize);
                    
                    // Add position number (for debugging/reference)
                    ctx.fillStyle = 'rgba(255,255,255,0.5)';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${r * gridSize + c + 1}`, pieceSize/2, pieceSize/2 + 5);
                    
                    pieces.push({
                        id: r * gridSize + c,
                        canvas: canvas,
                        currentPos: r * gridSize + c
                    });
                    correctOrder.push(r * gridSize + c);
                }
            }
            
            // Shuffle
            do {
                pieces.sort(() => Math.random() - 0.5);
            } while (checkWin(false));
            
            // Update current positions
            pieces.forEach((p, i) => p.currentPos = i);
            
            moves = 0;
            seconds = 0;
            isPlaying = true;
            selectedPiece = null;
            
            document.getElementById('moves').textContent = moves;
            document.getElementById('time').textContent = '00:00';
            document.getElementById('winMsg').classList.remove('show');
            
            clearInterval(timer);
            timer = setInterval(updateTime, 1000);
            
            drawPreview();
            renderBoard();
        }
        
        function drawPreview() {
            const canvas = document.getElementById('previewImage');
            const ctx = canvas.getContext('2d');
            canvas.width = 160;
            canvas.height = 160;
            
            const grad = ctx.createLinearGradient(0, 0, 160, 160);
            currentPattern.colors.forEach((c, i) => {
                grad.addColorStop(i / (currentPattern.colors.length - 1), c);
            });
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 160, 160);
        }
        
        function renderBoard() {
            const board = document.getElementById('puzzleBoard');
            board.innerHTML = '';
            
            pieces.forEach((piece, index) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece' + (selectedPiece === index ? ' selected' : '');
                div.appendChild(piece.canvas);
                div.onclick = () => handleClick(index);
                board.appendChild(div);
            });
        }
        
        function handleClick(index) {
            if (!isPlaying) return;
            
            if (selectedPiece === null) {
                selectedPiece = index;
            } else if (selectedPiece === index) {
                selectedPiece = null;
            } else {
                // Swap pieces
                [pieces[selectedPiece], pieces[index]] = [pieces[index], pieces[selectedPiece]];
                moves++;
                document.getElementById('moves').textContent = moves;
                selectedPiece = null;
                renderBoard();
                
                if (checkWin(true)) {
                    isPlaying = false;
                    clearInterval(timer);
                    document.getElementById('winMsg').classList.add('show');
                }
            }
            renderBoard();
        }
        
        function checkWin(actual) {
            for (let i = 0; i < pieces.length; i++) {
                if (pieces[i].id !== correctOrder[i]) return false;
            }
            return true;
        }
        
        function updateTime() {
            seconds++;
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('time').textContent = `${m}:${s}`;
        }
        
        function showHint() {
            // Find a misplaced piece and highlight where it should go
            for (let i = 0; i < pieces.length; i++) {
                if (pieces[i].id !== i) {
                    selectedPiece = i;
                    renderBoard();
                    setTimeout(() => {
                        selectedPiece = null;
                        renderBoard();
                    }, 1000);
                    break;
                }
            }
        }
        
        initImageSelect();
        initGame();
    </script>
</body>
</html>