<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¿è¿çœ‹</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    h1 { font-size: 1.5rem; margin-bottom: 10px; }
    .info { margin-bottom: 15px; }
    .game-board {
      display: grid;
      grid-template-columns: repeat(8, 45px);
      gap: 3px;
      background: #2a2a4e;
      padding: 10px;
      border-radius: 10px;
    }
    .cell {
      width: 45px; height: 45px;
      background: #4a4a6e;
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; cursor: pointer;
      transition: all 0.2s; user-select: none;
      border: 2px solid transparent;
    }
    .cell:hover:not(.empty) { background: #5a5a7e; }
    .cell.selected { border-color: #ffeb3b; background: #5a5a6e; }
    .cell.matched { opacity: 0; pointer-events: none; }
    .btn { margin-top: 15px; padding: 10px 25px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #45a049; }
    .btn.hint { background: #ff9800; }
    .back-link { margin-top: 15px; color: #888; text-decoration: none; }
    @media (max-width: 400px) {
      .game-board { grid-template-columns: repeat(8, 38px); }
      .cell { width: 38px; height: 38px; font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <h1>ğŸ”— è¿è¿çœ‹</h1>
  <p class="info">å‰©ä½™: <span id="remaining">32</span>å¯¹ | æç¤º: <span id="hints">3</span>æ¬¡</p>
  <div class="game-board" id="board"></div>
  <div style="display:flex;gap:10px;">
    <button class="btn" onclick="initGame()">æ–°æ¸¸æˆ</button>
    <button class="btn hint" onclick="showHint()">æç¤º</button>
  </div>
  <a href="index.html" class="back-link">â† è¿”å›æ¸¸æˆåˆ—è¡¨</a>

  <script>
    // ç¦æ­¢é•¿æŒ‰å¤åˆ¶èœå•
    document.addEventListener('contextmenu', e => e.preventDefault());
    const ROWS = 8, COLS = 8;
    const emojis = ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸ‰', 'ğŸ’', 'ğŸ“', 'ğŸ¥', 'ğŸ‘'];
    let board = [], selected = null, remaining = 32, hints = 3;

    function initGame() {
      board = Array(ROWS).fill(null).map(() => Array(COLS).fill(null));
      selected = null; remaining = 32; hints = 3;
      document.getElementById('remaining').textContent = remaining;
      document.getElementById('hints').textContent = hints;
      
      const pairs = [];
      for (let i = 0; i < 4; i++) {
        for (let j = 0; j < emojis.length; j++) {
          pairs.push(emojis[j], emojis[j]);
        }
      }
      pairs.sort(() => Math.random() - 0.5);
      
      let idx = 0;
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          board[r][c] = pairs[idx++];
        }
      }
      render();
    }

    function render() {
      const container = document.getElementById('board');
      container.innerHTML = '';
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (board[r][c]) {
            cell.textContent = board[r][c];
            cell.dataset.r = r; cell.dataset.c = c;
            cell.onclick = () => select(r, c, cell);
            if (selected && selected.r === r && selected.c === c) {
              cell.classList.add('selected');
            }
          } else {
            cell.classList.add('empty');
          }
          container.appendChild(cell);
        }
      }
    }

    function select(r, c, el) {
      if (!board[r][c]) return;
      
      if (!selected) {
        selected = { r, c, el };
        render();
        return;
      }
      
      if (selected.r === r && selected.c === c) {
        selected = null;
        render();
        return;
      }
      
      if (board[selected.r][selected.c] === board[r][c] && canConnect(selected.r, selected.c, r, c)) {
        board[selected.r][selected.c] = null;
        board[r][c] = null;
        remaining--;
        document.getElementById('remaining').textContent = remaining;
        selected = null;
        render();
        if (remaining === 0) {
          setTimeout(() => alert('ğŸ‰ æ­å–œé€šå…³ï¼'), 300);
        }
      } else {
        selected = { r, c, el };
        render();
      }
    }

    function canConnect(r1, c1, r2, c2) {
      if (board[r1][c1] !== board[r2][c2]) return false;
      
      // Direct line
      if (directConnect(r1, c1, r2, c2)) return true;
      
      // One turn
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          if (!board[r][c] || (r === r1 && c === c1) || (r === r2 && c === c2)) {
            if (directConnect(r1, c1, r, c) && directConnect(r, c, r2, c2)) return true;
          }
        }
      }
      return false;
    }

    function directConnect(r1, c1, r2, c2) {
      if (r1 === r2) {
        const min = Math.min(c1, c2), max = Math.max(c1, c2);
        for (let c = min + 1; c < max; c++) {
          if (board[r1][c]) return false;
        }
        return true;
      }
      if (c1 === c2) {
        const min = Math.min(r1, r2), max = Math.max(r1, r2);
        for (let r = min + 1; r < max; r++) {
          if (board[r][c1]) return false;
        }
        return true;
      }
      return false;
    }

    function showHint() {
      if (hints <= 0) return;
      for (let r1 = 0; r1 < ROWS; r1++) {
        for (let c1 = 0; c1 < COLS; c1++) {
          if (!board[r1][c1]) continue;
          for (let r2 = r1; r2 < ROWS; r2++) {
            for (let c2 = (r2 === r1 ? c1 + 1 : 0); c2 < COLS; c2++) {
              if (!board[r2][c2]) continue;
              if (canConnect(r1, c1, r2, c2)) {
                hints--;
                document.getElementById('hints').textContent = hints;
                const cells = document.querySelectorAll('.cell');
                cells[r1 * COLS + c1].style.borderColor = '#4CAF50';
                cells[r2 * COLS + c2].style.borderColor = '#4CAF50';
                setTimeout(() => render(), 1000);
                return;
              }
            }
          }
        }
      }
    }

    initGame();
  </script>
</body>
</html>
