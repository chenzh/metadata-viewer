<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á∫∏ÁâåÊé•Èæô - No WiFi Games</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; user-select: none; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #2d5a27 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            padding: 10px;
            overflow-x: auto;
        }
        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #fff;
            text-decoration: none;
            font-size: 1rem;
        }
        h1 { margin-top: 40px; font-size: 1.8rem; margin-bottom: 10px; }
        #gameArea {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 800px;
        }
        .top-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
        }
        .stock-pile, .waste-pile {
            width: 80px;
            height: 110px;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .stock-pile { background: rgba(0,0,0,0.3); }
        .stock-pile:hover { background: rgba(0,0,0,0.5); }
        .foundations {
            display: flex;
            gap: 10px;
        }
        .foundation {
            width: 80px;
            height: 110px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .tableau {
            display: flex;
            gap: 10px;
            justify-content: center;
            padding: 10px;
        }
        .column {
            width: 80px;
            min-height: 110px;
        }
        .card {
            width: 80px;
            height: 110px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            margin-bottom: -80px;
        }
        .card:last-child { margin-bottom: 0; }
        .card.face-down {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: transparent;
        }
        .card.red { color: #e94560; }
        .card.black { color: #333; }
        .card .suit { font-size: 2rem; }
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 12px 30px;
            background: #e94560;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }
        .win-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
        }
        .win-message h2 { font-size: 2.5rem; color: #4caf50; margin-bottom: 20px; }
        .card.selected {
            box-shadow: 0 0 0 4px #ffd700 !important;
            transform: translateY(-5px);
            z-index: 100;
        }
        .valid-target {
            animation: pulse 1s infinite;
            box-shadow: 0 0 0 4px #4caf50, 0 0 15px rgba(76, 175, 80, 0.5);
        }
        .foundation.valid-target {
            background: rgba(76, 175, 80, 0.2);
        }
        .column.valid-target::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 4px dashed #4caf50;
            border-radius: 8px;
            pointer-events: none;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 4px #4caf50, 0 0 15px rgba(76, 175, 80, 0.5); }
            50% { box-shadow: 0 0 0 6px #4caf50, 0 0 25px rgba(76, 175, 80, 0.8); }
        }
        .column { position: relative; }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">‚Üê ËøîÂõû</a>
    <h1>üÉè Á∫∏ÁâåÊé•Èæô</h1>
    
    <div id="gameArea">
        <div class="top-row">
            <div style="display: flex; gap: 10px;">
                <div class="stock-pile" id="stock" onclick="drawCard()">üé¥</div>
                <div class="waste-pile" id="waste"></div>
            </div>
            
            <div class="foundations">
                <div class="foundation" data-suit="‚ô†">‚ô†</div>
                <div class="foundation" data-suit="‚ô•">‚ô•</div>
                <div class="foundation" data-suit="‚ô£">‚ô£</div>
                <div class="foundation" data-suit="‚ô¶">‚ô¶</div>
            </div>
        </div>
        
        <div class="tableau" id="tableau"></div>
    </div>
    
    <div class="controls">
        <button onclick="initGame()">Êñ∞Ê∏∏Êàè</button>
    </div>
    
    <div class="win-message" id="winMsg">
        <h2>üéâ ÊÅ≠ÂñúËé∑ËÉúÔºÅ</h2>
        <button onclick="initGame()">ÂÜçÁé©‰∏ÄÊ¨°</button>
    </div>

    <script>
    // Á¶ÅÊ≠¢ÈïøÊåâÂ§çÂà∂ËèúÂçï
    document.addEventListener('contextmenu', e => e.preventDefault());
        const SUITS = ['‚ô†', '‚ô•', '‚ô£', '‚ô¶'];
        const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        let deck, stock, waste, foundations, tableau, selectedCard;
        
        function getValidTargets(card) {
            const targets = [];
            
            // Check foundations
            for (let suit of SUITS) {
                const foundation = foundations[suit];
                const expectedRank = foundation.length;
                if (card.suit === suit && RANKS.indexOf(card.rank) === expectedRank) {
                    targets.push({ type: 'foundation', suit });
                }
            }
            
            // Check tableau columns
            tableau.forEach((column, colIndex) => {
                if (column.length === 0) {
                    // Empty column - only K can be placed
                    if (card.rank === 'K') {
                        targets.push({ type: 'tableau', col: colIndex });
                    }
                } else {
                    const topCard = column[column.length - 1];
                    if (canPlaceOnTableau(card, topCard)) {
                        targets.push({ type: 'tableau', col: colIndex });
                    }
                }
            });
            
            return targets;
        }
        
        function createDeck() {
            const cards = [];
            for (let suit of SUITS) {
                for (let rank of RANKS) {
                    cards.push({ suit, rank, color: (suit === '‚ô•' || suit === '‚ô¶') ? 'red' : 'black' });
                }
            }
            return shuffle(cards);
        }
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function initGame() {
            deck = createDeck();
            stock = [...deck];
            waste = [];
            foundations = { '‚ô†': [], '‚ô•': [], '‚ô£': [], '‚ô¶': [] };
            tableau = Array(7).fill(null).map(() => []);
            selectedCard = null;
            
            // Deal to tableau
            for (let col = 0; col < 7; col++) {
                for (let row = 0; row <= col; row++) {
                    const card = stock.pop();
                    card.faceUp = (row === col);
                    tableau[col].push(card);
                }
            }
            
            document.getElementById('winMsg').style.display = 'none';
            render();
        }
        
        function render() {
            // Get valid targets if card is selected
            let validTargets = [];
            if (selectedCard) {
                let selectedCardData;
                if (selectedCard.type === 'waste') {
                    selectedCardData = selectedCard.card;
                } else {
                    selectedCardData = tableau[selectedCard.col][selectedCard.index];
                }
                validTargets = getValidTargets(selectedCardData);
            }
            
            // Stock
            document.getElementById('stock').textContent = stock.length > 0 ? 'üé¥' : '';
            document.getElementById('stock').style.opacity = stock.length > 0 ? 1 : 0.3;
            
            // Waste
            const wasteEl = document.getElementById('waste');
            wasteEl.innerHTML = '';
            if (waste.length > 0) {
                const card = waste[waste.length - 1];
                const isSelected = selectedCard && selectedCard.type === 'waste';
                wasteEl.appendChild(createCardElement(card, () => selectWasteCard(), false, isSelected));
            }
            
            // Foundations
            document.querySelectorAll('.foundation').forEach((el, i) => {
                const suit = SUITS[i];
                const pile = foundations[suit];
                el.innerHTML = '';
                el.classList.remove('valid-target');
                
                // Check if this foundation is a valid target
                if (validTargets.some(t => t.type === 'foundation' && t.suit === suit)) {
                    el.classList.add('valid-target');
                }
                
                if (pile.length > 0) {
                    const card = pile[pile.length - 1];
                    el.appendChild(createCardElement(card));
                } else {
                    el.textContent = suit;
                    el.style.opacity = 0.5;
                }
            });
            
            // Tableau
            const tableauEl = document.getElementById('tableau');
            tableauEl.innerHTML = '';
            tableau.forEach((column, colIndex) => {
                const colDiv = document.createElement('div');
                colDiv.className = 'column';
                
                // Check if this column is a valid target
                if (validTargets.some(t => t.type === 'tableau' && t.col === colIndex)) {
                    colDiv.classList.add('valid-target');
                }
                
                column.forEach((card, cardIndex) => {
                    const isTop = cardIndex === column.length - 1;
                    const isSelected = selectedCard && selectedCard.type === 'tableau' && 
                                      selectedCard.col === colIndex && selectedCard.index === cardIndex;
                    const cardEl = createCardElement(card, () => selectTableauCard(colIndex, cardIndex), !card.faceUp, isSelected);
                    colDiv.appendChild(cardEl);
                });
                tableauEl.appendChild(colDiv);
            });
            
            checkWin();
        }
        
        function createCardElement(card, onClick, faceDown = false, isSelected = false) {
            const el = document.createElement('div');
            el.className = `card ${faceDown ? 'face-down' : card.color} ${isSelected ? 'selected' : ''}`;
            if (!faceDown) {
                el.innerHTML = `<div>${card.rank}</div><div class="suit">${card.suit}</div>`;
            }
            if (onClick) el.onclick = onClick;
            return el;
        }
        
        function drawCard() {
            if (stock.length === 0) {
                if (waste.length > 0) {
                    stock = [...waste.reverse()];
                    waste = [];
                    stock.forEach(c => c.faceUp = false);
                }
            } else {
                const card = stock.pop();
                card.faceUp = true;
                waste.push(card);
            }
            selectedCard = null;
            render();
        }
        
        function selectWasteCard() {
            if (waste.length === 0) return;
            selectedCard = { type: 'waste', card: waste[waste.length - 1] };
            render();
        }
        
        function selectTableauCard(col, index) {
            const card = tableau[col][index];
            if (!card.faceUp) return;
            
            if (selectedCard) {
                if (selectedCard.type === 'waste') {
                    if (canPlaceOnTableau(selectedCard.card, card)) {
                        tableau[col].push(waste.pop());
                        selectedCard = null;
                        revealTopCard(col);
                    }
                } else if (selectedCard.col !== col) {
                    const sourceCard = tableau[selectedCard.col][selectedCard.index];
                    if (canPlaceOnTableau(sourceCard, card)) {
                        const cards = tableau[selectedCard.col].splice(selectedCard.index);
                        tableau[col].push(...cards);
                        selectedCard = null;
                        revealTopCard(selectedCard?.col);
                    }
                }
                selectedCard = null;
            } else {
                selectedCard = { type: 'tableau', col, index, card };
                
                // Try auto-move to foundation
                tryMoveToFoundation(col);
            }
            render();
        }
        
        function canPlaceOnTableau(movingCard, targetCard) {
            if (!targetCard) return movingCard.rank === 'K';
            const targetRank = RANKS.indexOf(targetCard.rank);
            const movingRank = RANKS.indexOf(movingCard.rank);
            return movingRank === targetRank - 1 && movingCard.color !== targetCard.color;
        }
        
        function tryMoveToFoundation(col) {
            const column = tableau[col];
            if (column.length === 0) return;
            const card = column[column.length - 1];
            const foundation = foundations[card.suit];
            const expectedRank = foundation.length;
            
            if (RANKS.indexOf(card.rank) === expectedRank) {
                foundation.push(column.pop());
                revealTopCard(col);
                selectedCard = null;
            }
        }
        
        function revealTopCard(col) {
            if (col !== undefined && tableau[col].length > 0) {
                const topCard = tableau[col][tableau[col].length - 1];
                if (!topCard.faceUp) topCard.faceUp = true;
            }
        }
        
        function checkWin() {
            const totalFoundation = Object.values(foundations).reduce((sum, f) => sum + f.length, 0);
            if (totalFoundation === 52) {
                document.getElementById('winMsg').style.display = 'block';
            }
        }
        
        initGame();
    </script>
</body>
</html>