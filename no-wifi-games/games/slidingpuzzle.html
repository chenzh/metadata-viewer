<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊªëÂä®ÊãºÂõæ - No WiFi Games</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            padding: 20px;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1rem;
        }
        h1 { margin-top: 50px; font-size: 2.2rem; margin-bottom: 10px; }
        .stats {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        .stats span { color: #e94560; font-weight: bold; }
        #gameBoard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
        }
        .tile {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #e94560, #c73e54);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .tile:hover:not(.empty) { transform: scale(1.05); filter: brightness(1.2); }
        .tile.empty { background: transparent; cursor: default; }
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        button {
            padding: 12px 30px;
            background: #e94560;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }
        .win-message {
            font-size: 1.5rem;
            color: #4caf50;
            margin-top: 20px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .win-message.show { opacity: 1; }
        @media (max-width: 350px) {
            .tile { width: 60px; height: 60px; font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">‚Üê ËøîÂõû</a>
    <h1>üé≤ ÊªëÂä®ÊãºÂõæ</h1>
    <div class="stats">
        <div>Ê≠•Êï∞: <span id="moves">0</span></div>
        <div>Êó∂Èó¥: <span id="time">00:00</span></div>
    </div>
    
    <div id="gameBoard"></div>
    
    <div class="win-message" id="winMsg">üéâ ÊÅ≠ÂñúÂÆåÊàêÔºÅ</div>
    
    <div class="controls">
        <button onclick="initGame()">Êñ∞Ê∏∏Êàè</button>
        <button onclick="solvePuzzle()">Êü•ÁúãÁ≠îÊ°à</button>
    </div>

    <script>
        const SIZE = 4;
        let board = [], emptyPos = { r: 3, c: 3 }, moves = 0, timer, seconds = 0, isPlaying = false;
        
        function initGame() {
            // Create solved board
            board = [];
            for (let r = 0; r < SIZE; r++) {
                board[r] = [];
                for (let c = 0; c < SIZE; c++) {
                    board[r][c] = r * SIZE + c + 1;
                }
            }
            board[SIZE-1][SIZE-1] = 0;
            emptyPos = { r: SIZE-1, c: SIZE-1 };
            
            // Shuffle
            shuffleBoard();
            
            moves = 0;
            seconds = 0;
            isPlaying = true;
            document.getElementById('moves').textContent = moves;
            document.getElementById('time').textContent = '00:00';
            document.getElementById('winMsg').classList.remove('show');
            
            clearInterval(timer);
            timer = setInterval(updateTime, 1000);
            
            renderBoard();
        }
        
        function shuffleBoard() {
            // Perform random valid moves to ensure solvability
            for (let i = 0; i < 200; i++) {
                const validMoves = getValidMoves();
                const move = validMoves[Math.floor(Math.random() * validMoves.length)];
                swapTiles(move.r, move.c, emptyPos.r, emptyPos.c);
                emptyPos = { r: move.r, c: move.c };
            }
        }
        
        function getValidMoves() {
            const moves = [];
            const dirs = [[-1,0], [1,0], [0,-1], [0,1]];
            dirs.forEach(([dr, dc]) => {
                const nr = emptyPos.r + dr, nc = emptyPos.c + dc;
                if (nr >= 0 && nr < SIZE && nc >= 0 && nc < SIZE) {
                    moves.push({ r: nr, c: nc });
                }
            });
            return moves;
        }
        
        function renderBoard() {
            const container = document.getElementById('gameBoard');
            container.innerHTML = '';
            
            for (let r = 0; r < SIZE; r++) {
                for (let c = 0; c < SIZE; c++) {
                    const tile = document.createElement('div');
                    tile.className = board[r][c] === 0 ? 'tile empty' : 'tile';
                    tile.textContent = board[r][c] || '';
                    tile.onclick = () => handleClick(r, c);
                    container.appendChild(tile);
                }
            }
        }
        
        function handleClick(r, c) {
            if (!isPlaying || board[r][c] === 0) return;
            
            // Check if adjacent to empty
            const dr = Math.abs(r - emptyPos.r);
            const dc = Math.abs(c - emptyPos.c);
            
            if ((dr === 1 && dc === 0) || (dr === 0 && dc === 1)) {
                swapTiles(r, c, emptyPos.r, emptyPos.c);
                emptyPos = { r, c };
                moves++;
                document.getElementById('moves').textContent = moves;
                renderBoard();
                
                if (checkWin()) {
                    isPlaying = false;
                    clearInterval(timer);
                    document.getElementById('winMsg').classList.add('show');
                }
            }
        }
        
        function swapTiles(r1, c1, r2, c2) {
            [board[r1][c1], board[r2][c2]] = [board[r2][c2], board[r1][c1]];
        }
        
        function checkWin() {
            for (let r = 0; r < SIZE; r++) {
                for (let c = 0; c < SIZE; c++) {
                    const expected = r * SIZE + c + 1;
                    if (r === SIZE-1 && c === SIZE-1) return true;
                    if (board[r][c] !== expected) return false;
                }
            }
            return true;
        }
        
        function updateTime() {
            seconds++;
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('time').textContent = `${m}:${s}`;
        }
        
        function solvePuzzle() {
            // Reset to solved state
            for (let r = 0; r < SIZE; r++) {
                for (let c = 0; c < SIZE; c++) {
                    board[r][c] = r * SIZE + c + 1;
                }
            }
            board[SIZE-1][SIZE-1] = 0;
            emptyPos = { r: SIZE-1, c: SIZE-1 };
            moves = 0;
            isPlaying = false;
            clearInterval(timer);
            document.getElementById('moves').textContent = moves;
            document.getElementById('winMsg').classList.remove('show');
            renderBoard();
        }
        
        initGame();
    </script>
</body>
</html>