<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Êï∞Áã¨</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    h1 { font-size: 1.5rem; margin-bottom: 10px; }
    .info { display: flex; gap: 20px; margin-bottom: 10px; }
    .info span { color: #888; }
    .sudoku-grid {
      display: grid;
      grid-template-columns: repeat(9, 40px);
      gap: 1px;
      background: #444;
      border: 3px solid #666;
    }
    .sudoku-cell {
      width: 40px; height: 40px;
      background: #2a2a4e;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; font-weight: bold;
      cursor: pointer; user-select: none;
      color: #fff;
    }
    .sudoku-cell:hover { background: #3a3a5e; }
    .sudoku-cell.fixed { background: #1a1a3e; color: #aaa; }
    .sudoku-cell.selected { background: #4a4a6e; }
    .sudoku-cell.error { color: #ff5252; }
    .sudoku-cell:nth-child(3n):not(:nth-child(9n)) { border-right: 2px solid #666; }
    .sudoku-cell:nth-child(n+19):nth-child(-n+27),
    .sudoku-cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid #666; }
    .numpad {
      display: grid;
      grid-template-columns: repeat(5, 50px);
      gap: 10px;
      margin-top: 15px;
    }
    .numpad button {
      width: 50px; height: 50px;
      background: #333; color: white;
      border: none; border-radius: 8px;
      font-size: 1.2rem; cursor: pointer;
    }
    .numpad button:active { background: #555; }
    .numpad button.clear { background: #ff5252; }
    .controls { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; justify-content: center; }
    .btn { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #45a049; }
    .btn.secondary { background: #2196F3; }
    .back-link { margin-top: 15px; color: #888; text-decoration: none; }
    @media (max-width: 400px) {
      .sudoku-grid { grid-template-columns: repeat(9, 35px); }
      .sudoku-cell { width: 35px; height: 35px; font-size: 1rem; }
      .numpad { grid-template-columns: repeat(5, 45px); }
      .numpad button { width: 45px; height: 45px; }
    }
  </style>
</head>
<body>
  <h1>üß© Êï∞Áã¨</h1>
  <div class="info">
    <span>ÈöæÂ∫¶: <select id="difficulty" onchange="newGame()">
      <option value="30">ÁÆÄÂçï</option>
      <option value="40" selected>‰∏≠Á≠â</option>
      <option value="50">Âõ∞Èöæ</option>
    </select></span>
    <span id="status"></span>
  </div>
  <div class="sudoku-grid" id="grid"></div>
  <div class="numpad">
    <button onclick="inputNum(1)">1</button>
    <button onclick="inputNum(2)">2</button>
    <button onclick="inputNum(3)">3</button>
    <button onclick="inputNum(4)">4</button>
    <button onclick="inputNum(5)">5</button>
    <button onclick="inputNum(6)">6</button>
    <button onclick="inputNum(7)">7</button>
    <button onclick="inputNum(8)">8</button>
    <button onclick="inputNum(9)">9</button>
    <button class="clear" onclick="clearCell()">‚úï</button>
  </div>
  <div class="controls">
    <button class="btn" onclick="newGame()">Êñ∞Ê∏∏Êàè</button>
    <button class="btn secondary" onclick="checkSolution()">Ê£ÄÊü•Á≠îÊ°à</button>
    <button class="btn secondary" onclick="showHint()">ÊèêÁ§∫</button>
  </div>
  <a href="index.html" class="back-link">‚Üê ËøîÂõûÊ∏∏ÊàèÂàóË°®</a>

  <script>
    // Á¶ÅÊ≠¢ÈïøÊåâÂ§çÂà∂ËèúÂçï
    document.addEventListener('contextmenu', e => e.preventDefault());
    let grid = [], solution = [], selectedCell = null, fixedCells = [];

    function generateSolution() {
      const board = Array(9).fill(null).map(() => Array(9).fill(0));
      
      function isValid(board, row, col, num) {
        for (let x = 0; x < 9; x++) if (board[row][x] === num) return false;
        for (let x = 0; x < 9; x++) if (board[x][col] === num) return false;
        const startRow = Math.floor(row / 3) * 3, startCol = Math.floor(col / 3) * 3;
        for (let i = 0; i < 3; i++) for (let j = 0; j < 3; j++)
          if (board[startRow + i][startCol + j] === num) return false;
        return true;
      }
      
      function solve(board) {
        for (let row = 0; row < 9; row++) {
          for (let col = 0; col < 9; col++) {
            if (board[row][col] === 0) {
              const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
              for (const num of nums) {
                if (isValid(board, row, col, num)) {
                  board[row][col] = num;
                  if (solve(board)) return true;
                  board[row][col] = 0;
                }
              }
              return false;
            }
          }
        }
        return true;
      }
      
      solve(board);
      return board;
    }

    function createPuzzle(solution, difficulty) {
      const puzzle = solution.map(row => [...row]);
      const positions = [];
      for (let i = 0; i < 81; i++) positions.push(i);
      positions.sort(() => Math.random() - 0.5);
      for (let i = 0; i < difficulty; i++) {
        const pos = positions[i];
        puzzle[Math.floor(pos / 9)][pos % 9] = 0;
      }
      return puzzle;
    }

    function renderGrid() {
      const container = document.getElementById('grid');
      container.innerHTML = '';
      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          const cell = document.createElement('div');
          cell.className = 'sudoku-cell';
          if (fixedCells[r][c]) cell.classList.add('fixed');
          if (grid[r][c] !== 0) cell.textContent = grid[r][c];
          cell.onclick = () => selectCell(r, c);
          cell.id = `cell-${r}-${c}`;
          container.appendChild(cell);
        }
      }
    }

    function selectCell(r, c) {
      if (fixedCells[r][c]) return;
      document.querySelectorAll('.sudoku-cell').forEach(c => c.classList.remove('selected'));
      selectedCell = { r, c };
      document.getElementById(`cell-${r}-${c}`).classList.add('selected');
    }

    function inputNum(num) {
      if (!selectedCell) return;
      const { r, c } = selectedCell;
      grid[r][c] = num;
      renderGrid();
      document.getElementById(`cell-${r}-${c}`).classList.add('selected');
    }

    function clearCell() {
      if (!selectedCell) return;
      const { r, c } = selectedCell;
      grid[r][c] = 0;
      renderGrid();
      document.getElementById(`cell-${r}-${c}`).classList.add('selected');
    }

    function checkSolution() {
      let correct = 0, total = 0;
      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          if (grid[r][c] !== 0) {
            total++;
            if (grid[r][c] === solution[r][c]) correct++;
          }
        }
      }
      const complete = JSON.stringify(grid) === JSON.stringify(solution);
      document.getElementById('status').textContent = complete ? '‚úÖ ÂÆåÊàêÔºÅ' : `Ê≠£Á°Æ: ${correct}/${total}`;
      if (complete) alert('üéâ ÊÅ≠Âñú‰Ω†ÂÆåÊàêÊï∞Áã¨ÔºÅ');
    }

    function showHint() {
      const emptyCells = [];
      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          if (grid[r][c] === 0 || grid[r][c] !== solution[r][c]) {
            emptyCells.push({ r, c });
          }
        }
      }
      if (emptyCells.length > 0) {
        const hint = emptyCells[Math.floor(Math.random() * emptyCells.length)];
        grid[hint.r][hint.c] = solution[hint.r][hint.c];
        renderGrid();
        document.getElementById('status').textContent = `ÊèêÁ§∫: (${hint.r + 1},${hint.c + 1})`;
      }
    }

    function newGame() {
      solution = generateSolution();
      const difficulty = parseInt(document.getElementById('difficulty').value);
      grid = createPuzzle(solution, difficulty);
      fixedCells = grid.map(row => row.map(cell => cell !== 0));
      selectedCell = null;
      document.getElementById('status').textContent = '';
      renderGrid();
    }

    newGame();
  </script>
</body>
</html>
