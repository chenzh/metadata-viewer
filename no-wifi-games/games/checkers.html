<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ë∑≥Ê£ã</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; user-select: none; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    h1 { font-size: 1.5rem; margin-bottom: 10px; }
    .info { margin-bottom: 10px; }
    .board {
      width: 320px; height: 320px;
      background: #d4a574;
      position: relative;
      border: 3px solid #8b6914;
    }
    .cell {
      position: absolute;
      width: 35px; height: 35px;
      border-radius: 50%;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 0;
    }
    .cell.dark { background: #8b6914; }
    .cell.light { background: #d4a574; }
    .cell.piece-red { background: radial-gradient(circle at 30% 30%, #ff7b7b, #d32f2f); border: 2px solid #b71c1c; }
    .cell.piece-black { background: radial-gradient(circle at 30% 30%, #666, #212121); border: 2px solid #000; }
    .cell.king::after { content: '‚òÖ'; color: gold; font-size: 14px; }
    .cell.selected { box-shadow: 0 0 10px #4CAF50, inset 0 0 10px #4CAF50; }
    .cell.valid { background: #69f0ae !important; opacity: 0.6; }
    .controls { display: flex; gap: 10px; margin-top: 15px; }
    .btn { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .back-link { margin-top: 15px; color: #888; text-decoration: none; }
    @media (max-width: 350px) {
      .board { width: 280px; height: 280px; }
      .cell { width: 30px; height: 30px; }
    }
  </style>
</head>
<body>
  <h1>üî¥ Ë∑≥Ê£ã ‚ö´</h1>
  <p class="info" id="status">Á∫¢ÊñπÂõûÂêà</p>
  <div class="board" id="board"></div>
  <div class="controls">
    <button class="btn" onclick="initGame()">Êñ∞Ê∏∏Êàè</button>
  </div>
  <a href="index.html" class="back-link">‚Üê ËøîÂõûÊ∏∏ÊàèÂàóË°®</a>

  <script>
    // Á¶ÅÊ≠¢ÈïøÊåâÂ§çÂà∂ËèúÂçï
    document.addEventListener('contextmenu', e => e.preventDefault());
    const BOARD_SIZE = 8;
    let board = [], current = 'red', selected = null, validMoves = [];

    function initGame() {
      board = Array(BOARD_SIZE).fill(null).map(() => Array(BOARD_SIZE).fill(null));
      // Red pieces (top)
      for (let r = 0; r < 3; r++) {
        for (let c = 0; c < BOARD_SIZE; c++) {
          if ((r + c) % 2 === 1) board[r][c] = { color: 'red', king: false };
        }
      }
      // Black pieces (bottom)
      for (let r = 5; r < BOARD_SIZE; r++) {
        for (let c = 0; c < BOARD_SIZE; c++) {
          if ((r + c) % 2 === 1) board[r][c] = { color: 'black', king: false };
        }
      }
      current = 'red';
      selected = null;
      validMoves = [];
      document.getElementById('status').textContent = 'Á∫¢ÊñπÂõûÂêà';
      render();
    }

    function render() {
      const container = document.getElementById('board');
      container.innerHTML = '';
      const cellSize = container.offsetWidth / BOARD_SIZE;
      
      for (let r = 0; r < BOARD_SIZE; r++) {
        for (let c = 0; c < BOARD_SIZE; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell ' + ((r + c) % 2 === 0 ? 'light' : 'dark');
          cell.style.width = cellSize + 'px';
          cell.style.height = cellSize + 'px';
          cell.style.left = (c * cellSize) + 'px';
          cell.style.top = (r * cellSize) + 'px';
          
          if (board[r][c]) {
            cell.classList.add(board[r][c].color === 'red' ? 'piece-red' : 'piece-black');
            if (board[r][c].king) cell.classList.add('king');
          }
          
          if (selected && selected.r === r && selected.c === c) cell.classList.add('selected');
          if (validMoves.some(m => m.r === r && m.c === c)) cell.classList.add('valid');
          
          cell.onclick = () => clickCell(r, c);
          container.appendChild(cell);
        }
      }
    }

    function clickCell(r, c) {
      // Move to valid position
      if (validMoves.some(m => m.r === r && m.c === c)) {
        const move = validMoves.find(m => m.r === r && m.c === c);
        board[r][c] = board[selected.r][selected.c];
        board[selected.r][selected.c] = null;
        
        // Capture
        if (move.capture) {
          board[move.capture.r][move.capture.c] = null;
        }
        
        // King promotion
        if (r === 0 && board[r][c].color === 'red') board[r][c].king = true;
        if (r === 7 && board[r][c].color === 'black') board[r][c].king = true;
        
        current = current === 'red' ? 'black' : 'red';
        selected = null;
        validMoves = [];
        document.getElementById('status').textContent = (current === 'red' ? 'Á∫¢Êñπ' : 'ÈªëÊñπ') + 'ÂõûÂêà';
        render();
        checkWin();
        if (current === 'black') setTimeout(aiMove, 500);
        return;
      }
      
      const piece = board[r][c];
      if (!piece || piece.color !== current) {
        selected = null;
        validMoves = [];
        render();
        return;
      }
      
      selected = { r, c };
      validMoves = getValidMoves(r, c);
      render();
    }

    function getValidMoves(r, c) {
      const piece = board[r][c];
      const moves = [];
      const dirs = piece.king ? [[-1,-1],[-1,1],[1,-1],[1,1]] : 
                   piece.color === 'red' ? [[1,-1],[1,1]] : [[-1,-1],[-1,1]];
      
      dirs.forEach(([dr, dc]) => {
        const nr = r + dr, nc = c + dc;
        if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8) {
          if (!board[nr][nc]) {
            moves.push({ r: nr, c: nc });
          } else if (board[nr][nc].color !== piece.color) {
            const nnr = nr + dr, nnc = nc + dc;
            if (nnr >= 0 && nnr < 8 && nnc >= 0 && nnc < 8 && !board[nnr][nnc]) {
              moves.push({ r: nnr, c: nnc, capture: { r: nr, c: nc } });
            }
          }
        }
      });
      return moves;
    }

    function aiMove() {
      const pieces = [];
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          if (board[r][c]?.color === 'black') {
            const moves = getValidMoves(r, c);
            if (moves.length > 0) pieces.push({ r, c, moves });
          }
        }
      }
      if (pieces.length === 0) return;
      
      // Prioritize captures
      const withCapture = pieces.flatMap(p => p.moves.filter(m => m.capture).map(m => ({ ...p, move: m })));
      const moves = withCapture.length > 0 ? withCapture : pieces.flatMap(p => p.moves.map(m => ({ ...p, move: m })));
      
      if (moves.length > 0) {
        const m = moves[Math.floor(Math.random() * moves.length)];
        selected = { r: m.r, c: m.c };
        validMoves = [m.move];
        clickCell(m.move.r, m.move.c);
      }
    }

    function checkWin() {
      let redCount = 0, blackCount = 0;
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          if (board[r][c]?.color === 'red') redCount++;
          if (board[r][c]?.color === 'black') blackCount++;
        }
      }
      if (redCount === 0) { alert('‚ö´ ÈªëÊñπËé∑ËÉúÔºÅ'); initGame(); }
      else if (blackCount === 0) { alert('üî¥ Á∫¢ÊñπËé∑ËÉúÔºÅ'); initGame(); }
    }

    initGame();
  </script>
</body>
</html>
