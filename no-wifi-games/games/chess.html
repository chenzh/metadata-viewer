<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>国际象棋</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    h1 { font-size: 1.5rem; margin-bottom: 10px; }
    .info { margin-bottom: 10px; }
    .board {
      display: grid;
      grid-template-columns: repeat(8, 40px);
      border: 3px solid #8b6914;
    }
    .cell {
      width: 40px; height: 40px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.8rem; cursor: pointer;
      user-select: none;
    }
    .cell.light { background: #f0d9b5; }
    .cell.dark { background: #b58863; }
    .cell.selected { background: #7b61ff !important; }
    .cell.valid { background: #69f0ae !important; opacity: 0.7; }
    .controls { display: flex; gap: 10px; margin-top: 15px; }
    .btn { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .back-link { margin-top: 15px; color: #888; text-decoration: none; }
    @media (max-width: 350px) {
      .board { grid-template-columns: repeat(8, 38px); }
      .cell { width: 38px; height: 38px; font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <h1>♟️ 国际象棋</h1>
  <p class="info" id="status">白方回合</p>
  <div class="board" id="board"></div>
  <div class="controls">
    <button class="btn" onclick="initGame()">新游戏</button>
  </div>
  <a href="index.html" class="back-link">← 返回游戏列表</a>

  <script>
    const PIECES = {
      white: { king: '♔', queen: '♕', rook: '♖', bishop: '♗', knight: '♘', pawn: '♙' },
      black: { king: '♚', queen: '♛', rook: '♜', bishop: '♝', knight: '♞', pawn: '♟' }
    };
    
    let board = [], current = 'white', selected = null, validMoves = [];

    function initGame() {
      board = [
        ['♜','♞','♝','♛','♚','♝','♞','♜'],
        ['♟','♟','♟','♟','♟','♟','♟','♟'],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        [null,null,null,null,null,null,null,null],
        ['♙','♙','♙','♙','♙','♙','♙','♙'],
        ['♖','♘','♗','♕','♔','♗','♘','♖']
      ];
      current = 'white';
      selected = null;
      validMoves = [];
      document.getElementById('status').textContent = '白方回合';
      render();
    }

    function render() {
      const container = document.getElementById('board');
      container.innerHTML = '';
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell ' + ((r + c) % 2 === 0 ? 'light' : 'dark');
          if (selected && selected.r === r && selected.c === c) cell.classList.add('selected');
          if (validMoves.some(m => m.r === r && m.c === c)) cell.classList.add('valid');
          if (board[r][c]) cell.textContent = board[r][c];
          cell.onclick = () => clickCell(r, c);
          container.appendChild(cell);
        }
      }
    }

    function clickCell(r, c) {
      if (validMoves.some(m => m.r === r && m.c === c)) {
        board[r][c] = board[selected.r][selected.c];
        board[selected.r][selected.c] = null;
        
        // Pawn promotion
        if ((board[r][c] === '♙' && r === 0) || (board[r][c] === '♟' && r === 7)) {
          board[r][c] = current === 'white' ? '♕' : '♛';
        }
        
        current = current === 'white' ? 'black' : 'white';
        selected = null;
        validMoves = [];
        document.getElementById('status').textContent = (current === 'white' ? '白方' : '黑方') + '回合';
        render();
        return;
      }
      
      const piece = board[r][c];
      if (!piece) { selected = null; validMoves = []; render(); return; }
      
      const isWhite = '♔♕♖♗♘♙'.includes(piece);
      if ((current === 'white' && !isWhite) || (current === 'black' && isWhite)) return;
      
      selected = { r, c };
      validMoves = getValidMoves(r, c, piece);
      render();
    }

    function getValidMoves(r, c, piece) {
      const moves = [];
      const isWhite = '♔♕♖♗♘♙'.includes(piece);
      const type = Object.keys(PIECES.white).find(k => PIECES.white[k] === piece || PIECES.black[k] === piece);
      
      const add = (dr, dc) => {
        const nr = r + dr, nc = c + dc;
        if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8) {
          const target = board[nr][nc];
          if (!target || ('♔♕♖♗♘♙'.includes(target)) !== isWhite) {
            moves.push({ r: nr, c: nc });
            return !target;
          }
        }
        return false;
      };
      
      if (type === 'pawn') {
        const dir = isWhite ? -1 : 1;
        if (!board[r + dir]?.[c]) moves.push({ r: r + dir, c });
        if ((isWhite && r === 6) || (!isWhite && r === 1)) {
          if (!board[r + dir]?.[c] && !board[r + dir * 2]?.[c]) moves.push({ r: r + dir * 2, c });
        }
        // Capture
        const left = board[r + dir]?.[c - 1], right = board[r + dir]?.[c + 1];
        if (left && ('♔♕♖♗♘♙'.includes(left)) !== isWhite) moves.push({ r: r + dir, c: c - 1 });
        if (right && ('♔♕♖♗♘♙'.includes(right)) !== isWhite) moves.push({ r: r + dir, c: c + 1 });
      }
      else if (type === 'knight') {
        [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc]) => add(dr,dc));
      }
      else if (type === 'king') {
        [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc]) => add(dr,dc));
      }
      else if (type === 'rook') {
        for (let i = 1; i < 8 && add(i, 0); i++);
        for (let i = 1; i < 8 && add(-i, 0); i++);
        for (let i = 1; i < 8 && add(0, i); i++);
        for (let i = 1; i < 8 && add(0, -i); i++);
      }
      else if (type === 'bishop') {
        for (let i = 1; i < 8 && add(i, i); i++);
        for (let i = 1; i < 8 && add(-i, -i); i++);
        for (let i = 1; i < 8 && add(i, -i); i++);
        for (let i = 1; i < 8 && add(-i, i); i++);
      }
      else if (type === 'queen') {
        for (let i = 1; i < 8 && add(i, 0); i++);
        for (let i = 1; i < 8 && add(-i, 0); i++);
        for (let i = 1; i < 8 && add(0, i); i++);
        for (let i = 1; i < 8 && add(0, -i); i++);
        for (let i = 1; i < 8 && add(i, i); i++);
        for (let i = 1; i < 8 && add(-i, -i); i++);
        for (let i = 1; i < 8 && add(i, -i); i++);
        for (let i = 1; i < 8 && add(-i, i); i++);
      }
      
      return moves;
    }

    initGame();
  </script>
</body>
</html>
