<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê∂àÊ∂à‰πê - No WiFi Games</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            padding: 20px;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #e94560;
            text-decoration: none;
            font-size: 1.1rem;
        }
        h1 { margin-top: 50px; font-size: 2.2rem; margin-bottom: 10px; }
        .score-board {
            font-size: 1.3rem;
            margin-bottom: 20px;
        }
        .score-board span { color: #e94560; font-size: 1.5rem; }
        #gameBoard {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
        }
        .gem {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .gem:hover { transform: scale(1.1); }
        .gem.selected { box-shadow: 0 0 0 3px #fff, 0 0 20px rgba(255,255,255,0.5); }
        .gem.matching { animation: pulse 0.5s; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        .gem.red { background: linear-gradient(135deg, #f44336, #d32f2f); }
        .gem.blue { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .gem.green { background: linear-gradient(135deg, #4caf50, #388e3c); }
        .gem.yellow { background: linear-gradient(135deg, #ffeb3b, #fbc02d); color: #333; }
        .gem.purple { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
        .gem.orange { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .gem.pink { background: linear-gradient(135deg, #e91e63, #c2185b); }
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        button {
            padding: 12px 30px;
            background: #e94560;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }
        @media (max-width: 400px) {
            .gem { width: 35px; height: 35px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">‚Üê ËøîÂõû</a>
    <h1>üíé Ê∂àÊ∂à‰πê</h1>
    <div class="score-board">ÂæóÂàÜ: <span id="score">0</span> | Ê≠•Êï∞: <span id="moves">30</span></div>
    <div id="gameBoard"></div>
    <div class="controls">
        <button onclick="initGame()">ÈáçÊñ∞ÂºÄÂßã</button>
        <button onclick="shuffleBoard()">Ê¥óÁâå</button>
    </div>

    <script>
        const ROWS = 8, COLS = 8;
        const GEM_TYPES = ['üî¥', 'üîµ', 'üü¢', 'üü°', 'üü£', 'üü†', 'üî¥'];
        const GEM_CLASSES = ['red', 'blue', 'green', 'yellow', 'purple', 'orange', 'pink'];
        let board = [], score = 0, moves = 30, selectedGem = null, isProcessing = false;
        
        function initGame() {
            score = 0;
            moves = 30;
            selectedGem = null;
            isProcessing = false;
            updateUI();
            createBoard();
            renderBoard();
            
            // Remove initial matches
            while (findMatches().length > 0) {
                removeMatches();
                fillBoard();
            }
            renderBoard();
        }
        
        function createBoard() {
            board = [];
            for (let r = 0; r < ROWS; r++) {
                board[r] = [];
                for (let c = 0; c < COLS; c++) {
                    board[r][c] = Math.floor(Math.random() * GEM_TYPES.length);
                }
            }
        }
        
        function renderBoard() {
            const container = document.getElementById('gameBoard');
            container.innerHTML = '';
            
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const gem = document.createElement('div');
                    gem.className = `gem ${GEM_CLASSES[board[r][c]]}`;
                    gem.textContent = GEM_TYPES[board[r][c]];
                    gem.dataset.row = r;
                    gem.dataset.col = c;
                    gem.onclick = () => handleClick(r, c);
                    container.appendChild(gem);
                }
            }
        }
        
        function handleClick(row, col) {
            if (isProcessing || moves <= 0) return;
            
            if (!selectedGem) {
                selectedGem = { row, col };
                highlightGem(row, col, true);
            } else {
                const r1 = selectedGem.row, c1 = selectedGem.col;
                const r2 = row, c2 = col;
                
                if (r1 === r2 && c1 === c2) {
                    highlightGem(r1, c1, false);
                    selectedGem = null;
                    return;
                }
                
                if (isAdjacent(r1, c1, r2, c2)) {
                    isProcessing = true;
                    highlightGem(r1, c1, false);
                    swapGems(r1, c1, r2, c2);
                    
                    setTimeout(() => {
                        if (findMatches().length > 0) {
                            moves--;
                            processMatches();
                        } else {
                            swapGems(r1, c1, r2, c2); // Swap back
                            isProcessing = false;
                        }
                        selectedGem = null;
                        updateUI();
                    }, 300);
                } else {
                    highlightGem(r1, c1, false);
                    selectedGem = { row, col };
                    highlightGem(row, col, true);
                }
            }
        }
        
        function isAdjacent(r1, c1, r2, c2) {
            return Math.abs(r1 - r2) + Math.abs(c1 - c2) === 1;
        }
        
        function highlightGem(row, col, selected) {
            const idx = row * COLS + col;
            const gem = document.getElementById('gameBoard').children[idx];
            if (selected) gem.classList.add('selected');
            else gem.classList.remove('selected');
        }
        
        function swapGems(r1, c1, r2, c2) {
            [board[r1][c1], board[r2][c2]] = [board[r2][c2], board[r1][c1]];
            renderBoard();
        }
        
        function findMatches() {
            const matches = new Set();
            
            // Horizontal
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS - 2; c++) {
                    if (board[r][c] === board[r][c+1] && board[r][c] === board[r][c+2]) {
                        matches.add(`${r},${c}`);
                        matches.add(`${r},${c+1}`);
                        matches.add(`${r},${c+2}`);
                    }
                }
            }
            
            // Vertical
            for (let c = 0; c < COLS; c++) {
                for (let r = 0; r < ROWS - 2; r++) {
                    if (board[r][c] === board[r+1][c] && board[r][c] === board[r+2][c]) {
                        matches.add(`${r},${c}`);
                        matches.add(`${r+1},${c}`);
                        matches.add(`${r+2},${c}`);
                    }
                }
            }
            
            return Array.from(matches);
        }
        
        function processMatches() {
            const matches = findMatches();
            if (matches.length === 0) {
                isProcessing = false;
                if (moves === 0) alert(`Ê∏∏ÊàèÁªìÊùüÔºÅÊúÄÁªàÂæóÂàÜ: ${score}`);
                return;
            }
            
            score += matches.length * 10;
            updateUI();
            
            // Animate matches
            matches.forEach(m => {
                const [r, c] = m.split(',').map(Number);
                const idx = r * COLS + c;
                document.getElementById('gameBoard').children[idx].classList.add('matching');
            });
            
            setTimeout(() => {
                removeMatches();
                applyGravity();
                fillBoard();
                renderBoard();
                setTimeout(() => processMatches(), 300);
            }, 500);
        }
        
        function removeMatches() {
            const matches = findMatches();
            matches.forEach(m => {
                const [r, c] = m.split(',').map(Number);
                board[r][c] = -1;
            });
        }
        
        function applyGravity() {
            for (let c = 0; c < COLS; c++) {
                let writeRow = ROWS - 1;
                for (let r = ROWS - 1; r >= 0; r--) {
                    if (board[r][c] !== -1) {
                        board[writeRow][c] = board[r][c];
                        if (writeRow !== r) board[r][c] = -1;
                        writeRow--;
                    }
                }
            }
        }
        
        function fillBoard() {
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    if (board[r][c] === -1) {
                        board[r][c] = Math.floor(Math.random() * GEM_TYPES.length);
                    }
                }
            }
        }
        
        function shuffleBoard() {
            if (moves > 0) {
                moves--;
                for (let r = 0; r < ROWS; r++) {
                    for (let c = 0; c < COLS; c++) {
                        board[r][c] = Math.floor(Math.random() * GEM_TYPES.length);
                    }
                }
                renderBoard();
                updateUI();
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('moves').textContent = moves;
        }
        
        initGame();
    </script>
</body>
</html>